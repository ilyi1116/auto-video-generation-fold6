<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡å–®éŸ³é »æ¸¬è©¦</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            line-height: 1.6; 
        }
        button {
            padding: 15px 30px;
            margin: 10px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .log {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        audio {
            width: 100%;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸµ ç°¡å–®éŸ³é »æ’­æ”¾æ¸¬è©¦</h1>
    
    <p>æ­¤é é¢ç”¨ä¾†æ¸¬è©¦éŸ³é »æ’­æ”¾åŠŸèƒ½ã€‚æ¸¬è©¦æœ€æ–°ç”Ÿæˆçš„éŸ³é »æ–‡ä»¶ï¼š</p>
    
    <div>
        <h3>æ–¹æ³•1: HTML5 Audio Element (controls)</h3>
        <audio id="audio1" controls preload="metadata">
            <source src="http://localhost:8001/audio/voice_1754749761_alloy_edge.mp3" type="audio/mpeg">
            æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³é »æ’­æ”¾ã€‚
        </audio>
    </div>
    
    <div>
        <h3>æ–¹æ³•2: JavaScript Audio Object</h3>
        <button onclick="testJSAudio()">â–¶ï¸ æ¸¬è©¦JSéŸ³é »æ’­æ”¾</button>
        <button onclick="stopJSAudio()">â¹ï¸ åœæ­¢</button>
        <div id="js-status">å°šæœªæ¸¬è©¦</div>
    </div>
    
    <div>
        <h3>æ–¹æ³•3: ç›´æ¥URLè¨ªå•æ¸¬è©¦</h3>
        <button onclick="testDirectURL()">ğŸ”— æ¸¬è©¦ç›´æ¥è¨ªå•</button>
        <button onclick="window.open('http://localhost:8001/audio/voice_1754749761_alloy_edge.mp3', '_blank')">ğŸ“‚ åœ¨æ–°é é¢æ‰“é–‹</button>
        <div id="url-status">å°šæœªæ¸¬è©¦</div>
    </div>

    <div class="log" id="log"></div>

    <script>
        let jsAudio = null;
        
        function log(message) {
            const time = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += `[${time}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[Audio Test] ${message}`);
        }

        function setStatus(id, message, color = 'black') {
            document.getElementById(id).innerHTML = `<span style="color: ${color}">${message}</span>`;
        }

        async function testJSAudio() {
            log('é–‹å§‹æ¸¬è©¦JavaScript Audioå°è±¡æ’­æ”¾...');
            
            try {
                if (jsAudio) {
                    jsAudio.pause();
                    jsAudio = null;
                }

                const audioUrl = 'http://localhost:8001/audio/voice_1754749761_alloy_edge.mp3';
                log(`éŸ³é »URL: ${audioUrl}`);
                
                jsAudio = new Audio(audioUrl);
                jsAudio.crossOrigin = 'anonymous';
                jsAudio.preload = 'metadata';

                // äº‹ä»¶ç›£è½å™¨
                jsAudio.addEventListener('loadstart', () => {
                    log('âœ… é–‹å§‹è¼‰å…¥éŸ³é »');
                    setStatus('js-status', 'æ­£åœ¨è¼‰å…¥...', 'orange');
                });

                jsAudio.addEventListener('loadedmetadata', () => {
                    log(`âœ… éŸ³é »å…ƒæ•¸æ“šè¼‰å…¥å®Œæˆï¼Œæ™‚é•·: ${jsAudio.duration.toFixed(1)} ç§’`);
                    setStatus('js-status', `å…ƒæ•¸æ“šå·²è¼‰å…¥ï¼Œæ™‚é•·: ${jsAudio.duration.toFixed(1)} ç§’`, 'blue');
                });

                jsAudio.addEventListener('canplaythrough', () => {
                    log('âœ… éŸ³é »å¯ä»¥å®Œæ•´æ’­æ”¾');
                    setStatus('js-status', 'éŸ³é »å°±ç·’ï¼Œå¯ä»¥æ’­æ”¾', 'green');
                });

                jsAudio.addEventListener('play', () => {
                    log('â–¶ï¸ éŸ³é »é–‹å§‹æ’­æ”¾');
                    setStatus('js-status', 'æ­£åœ¨æ’­æ”¾...', 'green');
                });

                jsAudio.addEventListener('pause', () => {
                    log('â¸ï¸ éŸ³é »å·²æš«åœ');
                    setStatus('js-status', 'æ’­æ”¾å·²æš«åœ', 'orange');
                });

                jsAudio.addEventListener('ended', () => {
                    log('â¹ï¸ éŸ³é »æ’­æ”¾çµæŸ');
                    setStatus('js-status', 'æ’­æ”¾çµæŸ', 'gray');
                });

                jsAudio.addEventListener('error', (e) => {
                    const error = jsAudio.error;
                    const errorMsg = error ? `éŒ¯èª¤ä»£ç¢¼ ${error.code}: ${error.message || 'æœªçŸ¥éŒ¯èª¤'}` : 'æœªçŸ¥éŒ¯èª¤';
                    log(`âŒ éŸ³é »éŒ¯èª¤: ${errorMsg}`);
                    setStatus('js-status', `æ’­æ”¾éŒ¯èª¤: ${errorMsg}`, 'red');
                });

                // å˜—è©¦æ’­æ”¾
                log('å˜—è©¦æ’­æ”¾éŸ³é »...');
                const playPromise = jsAudio.play();
                
                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            log('âœ… JavaScriptæ’­æ”¾æˆåŠŸå•Ÿå‹•');
                        })
                        .catch(error => {
                            log(`âŒ JavaScriptæ’­æ”¾å¤±æ•—: ${error.message}`);
                            setStatus('js-status', `æ’­æ”¾å¤±æ•—: ${error.message}`, 'red');
                        });
                }

            } catch (error) {
                log(`âŒ JavaScriptéŸ³é »æ¸¬è©¦ç•°å¸¸: ${error.message}`);
                setStatus('js-status', `æ¸¬è©¦ç•°å¸¸: ${error.message}`, 'red');
            }
        }

        function stopJSAudio() {
            if (jsAudio) {
                jsAudio.pause();
                jsAudio.currentTime = 0;
                log('â¹ï¸ JavaScriptéŸ³é »å·²åœæ­¢');
                setStatus('js-status', 'å·²åœæ­¢', 'gray');
            } else {
                log('âš ï¸ æ²’æœ‰æ­£åœ¨æ’­æ”¾çš„éŸ³é »');
            }
        }

        async function testDirectURL() {
            log('æ¸¬è©¦ç›´æ¥URLè¨ªå•...');
            setStatus('url-status', 'æ­£åœ¨æ¸¬è©¦...', 'orange');
            
            try {
                const audioUrl = 'http://localhost:8001/audio/voice_1754749761_alloy_edge.mp3';
                const response = await fetch(audioUrl, { method: 'HEAD' });
                
                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    const contentLength = response.headers.get('content-length');
                    const lastModified = response.headers.get('last-modified');
                    
                    log(`âœ… URLè¨ªå•æˆåŠŸ:`);
                    log(`   å…§å®¹é¡å‹: ${contentType}`);
                    log(`   æ–‡ä»¶å¤§å°: ${contentLength} å­—ç¯€`);
                    log(`   ä¿®æ”¹æ™‚é–“: ${lastModified}`);
                    
                    setStatus('url-status', 
                        `âœ… è¨ªå•æˆåŠŸ (${contentType}, ${(contentLength/1024).toFixed(1)}KB)`, 
                        'green'
                    );
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log(`âŒ URLè¨ªå•å¤±æ•—: ${error.message}`);
                setStatus('url-status', `âŒ è¨ªå•å¤±æ•—: ${error.message}`, 'red');
            }
        }

        // åˆå§‹åŒ–
        log('ğŸµ éŸ³é »æ¸¬è©¦é é¢å·²è¼‰å…¥');
        log('è«‹é»æ“Šä¸åŒçš„æ¸¬è©¦æŒ‰éˆ•ä¾†è¨ºæ–·éŸ³é »æ’­æ”¾å•é¡Œ');
        
        // æ¸¬è©¦HTML5 audio element
        const audio1 = document.getElementById('audio1');
        audio1.addEventListener('loadedmetadata', () => {
            log(`âœ… HTML5 Audioå…ƒç´ è¼‰å…¥å®Œæˆï¼Œæ™‚é•·: ${audio1.duration.toFixed(1)} ç§’`);
        });
        
        audio1.addEventListener('play', () => {
            log('â–¶ï¸ HTML5 Audioå…ƒç´ é–‹å§‹æ’­æ”¾');
        });
        
        audio1.addEventListener('error', (e) => {
            const error = audio1.error;
            const errorMsg = error ? `éŒ¯èª¤ä»£ç¢¼ ${error.code}` : 'æœªçŸ¥éŒ¯èª¤';
            log(`âŒ HTML5 Audioå…ƒç´ éŒ¯èª¤: ${errorMsg}`);
        });
    </script>
</body>
</html>
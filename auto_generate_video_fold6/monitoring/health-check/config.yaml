# å¥åº·æª¢æŸ¥ç›£æ§é…ç½®

# ç›£æ§è¨­å®š
monitoring:
  interval: 30  # æª¢æŸ¥é–“éš” (ç§’)
  timeout: 10   # è«‹æ±‚è¶…æ™‚ (ç§’)
  retries: 3    # é‡è©¦æ¬¡æ•¸
  alert_threshold: 3  # é€£çºŒå¤±æ•—æ¬¡æ•¸è§¸ç™¼å‘Šè­¦

# æœå‹™é…ç½®
services:
  # æ ¸å¿ƒ API æœå‹™
  - name: api-gateway
    type: http
    url: http://localhost:8080/health
    critical: true
    dependencies:
      - auth-service
      - data-service
    expected_response_time: 2.0
    health_check_path: /health
    
  - name: auth-service
    type: http
    url: http://localhost:8001/health
    critical: true
    dependencies:
      - postgresql
      - redis
    expected_response_time: 1.0
    
  - name: data-service
    type: http
    url: http://localhost:8002/health
    critical: true
    dependencies:
      - postgresql
      - s3
    expected_response_time: 1.5
    
  - name: ai-service
    type: http
    url: http://localhost:8003/health
    critical: true
    dependencies:
      - gpu-resources
    expected_response_time: 3.0
    
  - name: video-service
    type: http
    url: http://localhost:8004/health
    critical: true
    dependencies:
      - storage
      - ffmpeg
    expected_response_time: 2.0
    
  - name: social-service
    type: http
    url: http://localhost:8005/health
    critical: false
    dependencies:
      - external-apis
    expected_response_time: 5.0
    
  - name: trend-service
    type: http
    url: http://localhost:8006/health
    critical: false
    dependencies:
      - data-service
    expected_response_time: 2.0
    
  - name: inference-service
    type: http
    url: http://localhost:8007/health
    critical: true
    dependencies:
      - ai-models
    expected_response_time: 1.0
    
  - name: scheduler-service
    type: http
    url: http://localhost:8008/health
    critical: false
    dependencies:
      - celery
    expected_response_time: 1.0

  # åŸºç¤è¨­æ–½æœå‹™
  - name: postgresql
    type: database
    connection: postgresql://autovideo:${DB_PASSWORD}@localhost:5432/autovideo
    critical: true
    max_connections: 100
    
  - name: redis
    type: redis
    connection: redis://localhost:6379/0
    critical: true
    
  - name: elasticsearch
    type: http
    url: http://localhost:9200/_cluster/health
    critical: false
    expected_response_time: 2.0
    
  - name: prometheus
    type: http
    url: http://localhost:9090/-/healthy
    critical: false
    expected_response_time: 1.0
    
  - name: grafana
    type: http
    url: http://localhost:3001/api/health
    critical: false
    expected_response_time: 2.0

  # Docker å®¹å™¨æœå‹™
  - name: nginx
    type: docker
    container_name: auto-video-nginx
    critical: true
    
  - name: celery-worker
    type: docker
    container_name: auto-video-celery-worker
    critical: true
    
  - name: celery-beat
    type: docker
    container_name: auto-video-celery-beat
    critical: false

# ç³»çµ±æŒ‡æ¨™é–¾å€¼
system_thresholds:
  cpu_usage: 80.0        # CPU ä½¿ç”¨ç‡è­¦å‘Šé–¾å€¼ (%)
  memory_usage: 85.0     # è¨˜æ†¶é«”ä½¿ç”¨ç‡è­¦å‘Šé–¾å€¼ (%)
  disk_usage: 90.0       # ç£ç¢Ÿä½¿ç”¨ç‡è­¦å‘Šé–¾å€¼ (%)
  response_time: 5.0     # éŸ¿æ‡‰æ™‚é–“è­¦å‘Šé–¾å€¼ (ç§’)
  error_rate: 5.0        # éŒ¯èª¤ç‡è­¦å‘Šé–¾å€¼ (%)

# å‘Šè­¦é…ç½®
alerts:
  # é›»å­éƒµä»¶å‘Šè­¦
  email:
    enabled: true
    smtp_server: ${SMTP_SERVER:-localhost:587}
    smtp_username: ${SMTP_USERNAME}
    smtp_password: ${SMTP_PASSWORD}
    use_tls: true
    from: health-monitor@auto-video-system.com
    to:
      - ops@auto-video-system.com
      - admin@auto-video-system.com
    
    # å‘Šè­¦ç­‰ç´šé…ç½®
    levels:
      critical:
        to:
          - critical@auto-video-system.com
          - oncall@auto-video-system.com
        subject_prefix: "ğŸš¨ [CRITICAL]"
      
      high:
        to:
          - alerts@auto-video-system.com
        subject_prefix: "âš ï¸ [HIGH]"
      
      medium:
        to:
          - monitoring@auto-video-system.com
        subject_prefix: "ğŸ“Š [MEDIUM]"

  # Webhook å‘Šè­¦
  webhook:
    enabled: true
    url: http://alertmanager:9093/api/v1/alerts
    timeout: 5
    headers:
      Content-Type: application/json
      Authorization: Bearer ${WEBHOOK_TOKEN}

  # Slack å‘Šè­¦
  slack:
    enabled: true
    webhook_url: ${SLACK_WEBHOOK_URL}
    channel: "#alerts"
    username: "Health Monitor"
    icon_emoji: ":warning:"

  # å‘Šè­¦è¦å‰‡
  rules:
    # æœå‹™ä¸‹ç·šå‘Šè­¦
    - name: service_down
      condition: status == "unhealthy"
      severity: critical
      message: "Service {{service_name}} is down"
      
    # éŸ¿æ‡‰æ™‚é–“å‘Šè­¦
    - name: slow_response
      condition: response_time > expected_response_time * 2
      severity: warning
      message: "Service {{service_name}} is responding slowly"
      
    # ä¾è³´æœå‹™æ•…éšœå‘Šè­¦
    - name: dependency_failure
      condition: dependency_status == "unhealthy"
      severity: high
      message: "Service {{service_name}} dependency {{dependency}} is failing"
      
    # ç³»çµ±è³‡æºå‘Šè­¦
    - name: high_cpu_usage
      condition: cpu_usage > system_thresholds.cpu_usage
      severity: warning
      message: "High CPU usage: {{cpu_usage}}%"
      
    - name: high_memory_usage
      condition: memory_usage > system_thresholds.memory_usage
      severity: warning
      message: "High memory usage: {{memory_usage}}%"
      
    - name: high_disk_usage
      condition: disk_usage > system_thresholds.disk_usage
      severity: critical
      message: "High disk usage: {{disk_usage}}%"

# æ¢å¾©æª¢æŸ¥é…ç½®
recovery:
  # æ¢å¾©é©—è­‰æ¬¡æ•¸
  verification_count: 3
  
  # æ¢å¾©æª¢æŸ¥é–“éš”
  verification_interval: 10
  
  # è‡ªå‹•æ¢å¾©å‹•ä½œ
  auto_recovery:
    enabled: true
    max_attempts: 3
    
    actions:
      - type: restart_container
        condition: container_status == "exited"
        
      - type: clear_cache
        condition: service_name == "redis" and status == "unhealthy"
        
      - type: reload_config
        condition: response_time > expected_response_time * 3

# å ±å‘Šé…ç½®
reporting:
  # æ¯æ—¥å¥åº·å ±å‘Š
  daily_report:
    enabled: true
    time: "09:00"
    recipients:
      - ops@auto-video-system.com
    
  # æ¯é€±å¥åº·å ±å‘Š
  weekly_report:
    enabled: true
    day: "monday"
    time: "09:00"
    recipients:
      - management@auto-video-system.com
    
  # æœˆåº¦å¥åº·å ±å‘Š
  monthly_report:
    enabled: true
    day: 1
    time: "09:00"
    recipients:
      - executives@auto-video-system.com

# å„²å­˜é…ç½®
storage:
  # æ­·å²è³‡æ–™ä¿ç•™
  retention:
    health_status: 30d    # å¥åº·ç‹€æ…‹è³‡æ–™ä¿ç•™ 30 å¤©
    metrics: 90d          # æŒ‡æ¨™è³‡æ–™ä¿ç•™ 90 å¤©
    alerts: 365d          # å‘Šè­¦è¨˜éŒ„ä¿ç•™ 1 å¹´
  
  # è³‡æ–™åº«é…ç½®
  database:
    url: postgresql://health_monitor:${HEALTH_DB_PASSWORD}@localhost:5432/health_monitoring
    pool_size: 10
    max_overflow: 20

# å®‰å…¨é…ç½®
security:
  # API å®‰å…¨
  api_key: ${HEALTH_API_KEY}
  
  # TLS é…ç½®
  tls:
    enabled: false
    cert_file: /etc/ssl/certs/health-monitor.crt
    key_file: /etc/ssl/private/health-monitor.key
  
  # å­˜å–æ§åˆ¶
  access_control:
    allowed_ips:
      - 127.0.0.1
      - 10.0.0.0/8
      - 172.16.0.0/12
      - 192.168.0.0/16

# æ•ˆèƒ½èª¿æ•´
performance:
  # ä¸¦ç™¼æª¢æŸ¥æ•¸
  concurrent_checks: 10
  
  # è«‹æ±‚æ± å¤§å°
  connection_pool_size: 50
  
  # å¿«å–è¨­å®š
  cache:
    enabled: true
    ttl: 60  # å¿«å–å­˜æ´»æ™‚é–“ (ç§’)
    
  # æ‰¹æ¬¡è™•ç†
  batch_processing:
    enabled: true
    batch_size: 20
    max_wait_time: 5

# é™¤éŒ¯é…ç½®
debug:
  enabled: false
  log_level: INFO
  log_file: /var/log/health-monitor.log
  detailed_logging: false
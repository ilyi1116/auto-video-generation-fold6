# ========================================
# 高級生產環境配置
# 企業級微服務架構配置
# ========================================

# ========================================
# 基礎環境配置
# ========================================
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=info
STRUCTURED_LOGGING=true
APP_NAME=auto-video-generation
APP_VERSION=${APP_VERSION:-1.0.0}

# ========================================
# 安全配置
# ========================================
# JWT 配置（生產環境必須使用強密鑰）
JWT_SECRET_KEY=${JWT_SECRET_KEY}
JWT_ALGORITHM=RS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7
JWT_ISSUER=auto-video-api
JWT_AUDIENCE=auto-video-clients

# 加密密鑰（用於敏感數據加密）
ENCRYPTION_KEY=${ENCRYPTION_KEY}
FERNET_KEY=${FERNET_KEY}

# CORS 配置
CORS_ORIGINS=https://yourdomain.com,https://app.yourdomain.com,https://admin.yourdomain.com
CORS_CREDENTIALS=true
CORS_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS
CORS_HEADERS=*
CORS_MAX_AGE=86400

# 安全頭部
SECURITY_HEADERS_ENABLED=true
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUBDOMAINS=true
CSP_POLICY=default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://api.yourdomain.com wss://api.yourdomain.com

# X-Frame-Options
X_FRAME_OPTIONS=DENY
X_CONTENT_TYPE_OPTIONS=nosniff
REFERRER_POLICY=strict-origin-when-cross-origin

# ========================================
# 數據庫配置
# ========================================
# PostgreSQL 主數據庫
DATABASE_URL=postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}?sslmode=require
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=30
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600
DATABASE_ENGINE_ECHO=false

# 讀寫分離（可選）
DATABASE_READ_URL=postgresql://${DB_READ_USER}:${DB_READ_PASSWORD}@${DB_READ_HOST}:${DB_READ_PORT}/${DB_READ_NAME}?sslmode=require

# 數據庫連接池配置
DB_POOL_PRE_PING=true
DB_POOL_RESET_ON_RETURN=commit
DB_ISOLATION_LEVEL=READ_COMMITTED

# Redis 配置
REDIS_URL=redis://${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}?ssl_cert_reqs=required
REDIS_PASSWORD=${REDIS_PASSWORD}
REDIS_MAX_CONNECTIONS=50
REDIS_RETRY_ON_TIMEOUT=true
REDIS_HEALTH_CHECK_INTERVAL=30
REDIS_CONNECTION_POOL_MAX_CONNECTIONS=50

# Redis Sentinel 配置（高可用）
REDIS_SENTINEL_ENABLED=false
REDIS_SENTINEL_HOSTS=${REDIS_SENTINEL_HOSTS}
REDIS_SENTINEL_SERVICE_NAME=${REDIS_SENTINEL_SERVICE_NAME}

# ========================================
# 服務端口配置
# ========================================
API_GATEWAY_PORT=8000
AUTH_SERVICE_PORT=8001
DATA_SERVICE_PORT=8002
INFERENCE_SERVICE_PORT=8003
VIDEO_SERVICE_PORT=8004
AI_SERVICE_PORT=8005
SOCIAL_SERVICE_PORT=8006
TREND_SERVICE_PORT=8007
SCHEDULER_SERVICE_PORT=8008
STORAGE_SERVICE_PORT=8009
TRAINING_WORKER_PORT=8010
DATA_INGESTION_PORT=8011
GRAPHQL_GATEWAY_PORT=8012
VOICE_ENHANCEMENT_PORT=8013

# ========================================
# 服務間通訊配置
# ========================================
# 服務發現
SERVICE_DISCOVERY_ENABLED=true
SERVICE_REGISTRY_TYPE=consul  # consul, etcd, kubernetes
SERVICE_REGISTRY_URL=${SERVICE_REGISTRY_URL}

# 負載均衡
LOAD_BALANCE_STRATEGY=weighted_round_robin
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=5
HEALTH_CHECK_RETRIES=3

# 熔斷器配置
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60
CIRCUIT_BREAKER_SUCCESS_THRESHOLD=3

# 重試配置
RETRY_MAX_ATTEMPTS=3
RETRY_INITIAL_DELAY=1.0
RETRY_MAX_DELAY=60.0
RETRY_EXPONENTIAL_BASE=2.0

# 服務間通訊超時
SERVICE_TIMEOUT=30
CONNECTION_TIMEOUT=10
READ_TIMEOUT=30

# ========================================
# 存儲配置
# ========================================
# S3 兼容存儲
S3_BUCKET_NAME=${S3_BUCKET_NAME}
S3_ACCESS_KEY_ID=${S3_ACCESS_KEY_ID}
S3_SECRET_ACCESS_KEY=${S3_SECRET_ACCESS_KEY}
S3_ENDPOINT_URL=${S3_ENDPOINT_URL}
S3_REGION=${S3_REGION}
S3_USE_SSL=true
S3_SIGNATURE_VERSION=s3v4

# S3 生命周期管理
S3_LIFECYCLE_ENABLED=true
S3_TRANSITION_TO_IA_DAYS=30
S3_TRANSITION_TO_GLACIER_DAYS=90
S3_EXPIRATION_DAYS=365

# CDN 配置
CDN_ENABLED=true
CDN_URL=${CDN_URL}
CDN_CACHE_CONTROL=max-age=86400
CDN_SIGNED_URLS=true
CDN_SIGNED_URL_EXPIRY=3600

# 本地存儲（備用）
UPLOAD_PATH=/app/uploads
TEMP_PATH=/app/temp
MAX_UPLOAD_SIZE_MB=500
ALLOWED_MIME_TYPES=audio/mpeg,audio/wav,audio/mp4,video/mp4,video/avi,video/quicktime,image/jpeg,image/png

# ========================================
# 外部 API 配置
# ========================================
# OpenAI/Azure OpenAI
OPENAI_API_TYPE=azure  # openai, azure
OPENAI_API_KEY=${OPENAI_API_KEY}
OPENAI_API_BASE=${OPENAI_API_BASE}
OPENAI_API_VERSION=2024-02-01
OPENAI_MODEL=gpt-4
OPENAI_MAX_TOKENS=4000
OPENAI_TEMPERATURE=0.7
OPENAI_TIMEOUT=60

# Google Gemini API
GEMINI_API_KEY=${GEMINI_API_KEY}
GEMINI_MODEL=gemini-pro
GEMINI_TEMPERATURE=0.7
GEMINI_MAX_OUTPUT_TOKENS=2048

# Stable Diffusion API
STABLE_DIFFUSION_API_KEY=${STABLE_DIFFUSION_API_KEY}
STABLE_DIFFUSION_API_URL=https://api.stability.ai/v1
STABLE_DIFFUSION_ENGINE=stable-diffusion-xl-1024-v1-0
STABLE_DIFFUSION_STEPS=30
STABLE_DIFFUSION_GUIDANCE_SCALE=7

# Suno API
SUNO_API_KEY=${SUNO_API_KEY}
SUNO_API_URL=https://api.suno.ai
SUNO_MODEL=chirp-v3-5
SUNO_DURATION=240

# ElevenLabs API
ELEVENLABS_API_KEY=${ELEVENLABS_API_KEY}
ELEVENLABS_API_URL=https://api.elevenlabs.io/v1
ELEVENLABS_VOICE_ID=${ELEVENLABS_VOICE_ID}
ELEVENLABS_VOICE_STABILITY=0.5
ELEVENLABS_VOICE_SIMILARITY_BOOST=0.8

# 社交媒體 API
YOUTUBE_API_KEY=${YOUTUBE_API_KEY}
YOUTUBE_CLIENT_ID=${YOUTUBE_CLIENT_ID}
YOUTUBE_CLIENT_SECRET=${YOUTUBE_CLIENT_SECRET}

INSTAGRAM_ACCESS_TOKEN=${INSTAGRAM_ACCESS_TOKEN}
INSTAGRAM_CLIENT_ID=${INSTAGRAM_CLIENT_ID}
INSTAGRAM_CLIENT_SECRET=${INSTAGRAM_CLIENT_SECRET}

TIKTOK_CLIENT_KEY=${TIKTOK_CLIENT_KEY}
TIKTOK_CLIENT_SECRET=${TIKTOK_CLIENT_SECRET}
TIKTOK_ACCESS_TOKEN=${TIKTOK_ACCESS_TOKEN}

# ========================================
# 監控和可觀測性
# ========================================
# Sentry 錯誤追蹤
SENTRY_DSN=${SENTRY_DSN}
SENTRY_ENVIRONMENT=production
SENTRY_RELEASE=${APP_VERSION}
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_DEBUG=false
SENTRY_ATTACH_STACKTRACE=true

# Prometheus 指標
PROMETHEUS_ENABLED=true
METRICS_PORT=9090
METRICS_PATH=/metrics
METRICS_NAMESPACE=autovideo
HISTOGRAM_BUCKETS=0.1,0.25,0.5,1.0,2.5,5.0,10.0

# OpenTelemetry 分佈式追蹤
OTEL_ENABLED=true
OTEL_SERVICE_NAME=${SERVICE_NAME}
OTEL_SERVICE_VERSION=${APP_VERSION}
OTEL_EXPORTER_OTLP_ENDPOINT=${OTEL_ENDPOINT}
OTEL_EXPORTER_OTLP_HEADERS=${OTEL_HEADERS}
OTEL_RESOURCE_ATTRIBUTES=service.name=${SERVICE_NAME},service.version=${APP_VERSION},deployment.environment=production
OTEL_TRACES_EXPORTER=otlp
OTEL_METRICS_EXPORTER=otlp
OTEL_LOGS_EXPORTER=otlp

# Jaeger 追蹤
JAEGER_ENABLED=false
JAEGER_AGENT_HOST=${JAEGER_AGENT_HOST}
JAEGER_AGENT_PORT=6831
JAEGER_COLLECTOR_ENDPOINT=${JAEGER_COLLECTOR_ENDPOINT}

# 日誌配置
LOG_FORMAT=json
LOG_FILE=/app/logs/app.log
LOG_ROTATION=daily
LOG_RETENTION_DAYS=30
LOG_MAX_FILE_SIZE=100MB
LOG_BACKUP_COUNT=10

# 結構化日誌字段
LOG_INCLUDE_TIMESTAMP=true
LOG_INCLUDE_LEVEL=true
LOG_INCLUDE_LOGGER=true
LOG_INCLUDE_TRACE_ID=true
LOG_INCLUDE_REQUEST_ID=true

# ========================================
# 性能和擴展配置
# ========================================
# 服務器配置
WORKERS=4
WORKER_CLASS=uvicorn.workers.UvicornWorker
WORKER_CONNECTIONS=1000
MAX_REQUESTS=10000
MAX_REQUESTS_JITTER=1000
PRELOAD=true

# 超時配置
REQUEST_TIMEOUT=30
KEEP_ALIVE_TIMEOUT=5
GRACEFUL_TIMEOUT=30
CLIENT_TIMEOUT=30

# 連接池配置
CONNECTION_POOL_SIZE=100
CONNECTION_POOL_MAX_OVERFLOW=50
CONNECTION_POOL_TIMEOUT=30

# 限流配置
RATE_LIMIT_ENABLED=true
RATE_LIMIT_STORAGE=redis
RATE_LIMIT_PER_MINUTE=1000
RATE_LIMIT_PER_HOUR=50000
RATE_LIMIT_PER_DAY=1000000
RATE_LIMIT_BURST=100

# 並發控制
MAX_CONCURRENT_REQUESTS=1000
MAX_CONCURRENT_CONNECTIONS=100
SEMAPHORE_LIMIT=50

# ========================================
# 任務隊列配置 (Celery)
# ========================================
# Broker 配置
CELERY_BROKER_URL=redis://${REDIS_HOST}:${REDIS_PORT}/1
CELERY_RESULT_BACKEND=redis://${REDIS_HOST}:${REDIS_PORT}/2

# 序列化配置
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json,msgpack
CELERY_RESULT_ACCEPT_CONTENT=json,msgpack

# 時區配置
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=true

# 工作進程配置
CELERY_WORKER_CONCURRENCY=4
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000
CELERY_WORKER_MAX_MEMORY_PER_CHILD=200000  # KB
CELERY_TASK_SOFT_TIME_LIMIT=300
CELERY_TASK_TIME_LIMIT=600
CELERY_TASK_ALWAYS_EAGER=false

# 任務路由
CELERY_TASK_ROUTES={
    "training.*": {"queue": "training"},
    "inference.*": {"queue": "inference"},
    "video.*": {"queue": "video"},
    "social.*": {"queue": "social"}
}

# 隊列配置
CELERY_TASK_DEFAULT_QUEUE=default
CELERY_TASK_DEFAULT_EXCHANGE=default
CELERY_TASK_DEFAULT_ROUTING_KEY=default

# 監控配置
CELERY_SEND_TASK_EVENTS=true
CELERY_SEND_EVENTS=true
CELERY_TASK_TRACK_STARTED=true

# ========================================
# SSL/TLS 配置
# ========================================
SSL_ENABLED=true
SSL_CERT_PATH=/app/ssl/cert.pem
SSL_KEY_PATH=/app/ssl/key.pem
SSL_CA_BUNDLE_PATH=/app/ssl/ca-bundle.pem
SSL_VERIFY_MODE=CERT_REQUIRED
SSL_CHECK_HOSTNAME=true

# TLS 版本
TLS_MIN_VERSION=1.2
TLS_MAX_VERSION=1.3
TLS_CIPHERS=ECDHE+AESGCM:ECDHE+CHACHA20:DHE+AESGCM:DHE+CHACHA20:!aNULL:!MD5:!DSS

# ========================================
# 備份和災難恢復
# ========================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # 每天凌晨 2 點
BACKUP_RETENTION_DAYS=30
BACKUP_COMPRESSION=gzip
BACKUP_ENCRYPTION_ENABLED=true
BACKUP_ENCRYPTION_KEY=${BACKUP_ENCRYPTION_KEY}

# 備份存儲
BACKUP_STORAGE_TYPE=s3
BACKUP_S3_BUCKET=${BACKUP_S3_BUCKET}
BACKUP_S3_PREFIX=backups/production/

# 災難恢復
DR_ENABLED=true
DR_RTO=4  # Recovery Time Objective (hours)
DR_RPO=1  # Recovery Point Objective (hours)
DR_BACKUP_SITES=${DR_BACKUP_SITES}

# ========================================
# 功能開關
# ========================================
FEATURE_FLAGS_ENABLED=true
FEATURE_FLAGS_PROVIDER=launchdarkly  # launchdarkly, flagsmith, custom

# 核心功能
FEATURE_AI_GENERATION=true
FEATURE_VIDEO_PROCESSING=true
FEATURE_SOCIAL_PUBLISHING=true
FEATURE_TREND_ANALYSIS=true
FEATURE_VOICE_CLONING=true
FEATURE_BATCH_PROCESSING=true

# 實驗性功能
FEATURE_REAL_TIME_COLLABORATION=false
FEATURE_ADVANCED_ANALYTICS=false
FEATURE_API_V2=false
FEATURE_MOBILE_APP_SYNC=false

# ========================================
# 緩存配置
# ========================================
CACHE_ENABLED=true
CACHE_TYPE=redis
CACHE_DEFAULT_TTL=3600
CACHE_MAX_SIZE=1000
CACHE_KEY_PREFIX=autovideo:cache:

# API 響應緩存
API_CACHE_ENABLED=true
API_CACHE_TTL=300
API_CACHE_VARY_ON_HEADERS=Authorization,Accept-Language

# 靜態資源緩存
STATIC_CACHE_TTL=86400
STATIC_CACHE_MAX_AGE=31536000

# ========================================
# 健康檢查配置
# ========================================
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_TIMEOUT=5
HEALTH_CHECK_DETAILED=false

# 依賴服務健康檢查
CHECK_DATABASE=true
CHECK_REDIS=true
CHECK_EXTERNAL_APIS=true
CHECK_STORAGE=true
CHECK_QUEUE=true

# 健康檢查閾值
HEALTH_CHECK_DATABASE_TIMEOUT=2
HEALTH_CHECK_REDIS_TIMEOUT=1
HEALTH_CHECK_API_TIMEOUT=5

# ========================================
# 版本和元數據
# ========================================
APP_VERSION=${APP_VERSION:-1.0.0}
BUILD_DATE=${BUILD_DATE}
BUILD_NUMBER=${BUILD_NUMBER}
COMMIT_SHA=${COMMIT_SHA}
COMMIT_BRANCH=${COMMIT_BRANCH}
ENVIRONMENT_NAME=production
DEPLOYMENT_ID=${DEPLOYMENT_ID}

# ========================================
# 合規和安全審計
# ========================================
AUDIT_LOGGING_ENABLED=true
AUDIT_LOG_FILE=/app/logs/audit.log
AUDIT_LOG_RETENTION_DAYS=90

# GDPR 合規
GDPR_ENABLED=true
DATA_RETENTION_DAYS=365
ANONYMIZE_LOGS=true
COOKIE_CONSENT_REQUIRED=true

# PCI DSS 合規（如有支付功能）
PCI_COMPLIANCE_ENABLED=false
PAYMENT_DATA_ENCRYPTION=true
PAYMENT_LOG_MASKING=true

# ========================================
# 國際化配置
# ========================================
I18N_ENABLED=true
DEFAULT_LANGUAGE=en
SUPPORTED_LANGUAGES=en,zh,es,fr,de,ja,ko
TIMEZONE=UTC
DATE_FORMAT=ISO8601

# ========================================
# API 版本管理
# ========================================
API_VERSION=v1
API_DEPRECATED_VERSIONS=
API_SUNSET_DATE=
API_VERSIONING_STRATEGY=header  # header, path, query

# ========================================
# 開發和調試配置（生產環境設為 false）
# ========================================
ENABLE_DOCS=false
ENABLE_ADMIN_PANEL=false
ENABLE_DEBUG_TOOLBAR=false
MOCK_EXTERNAL_APIs=false
ENABLE_PROFILING=false

# ========================================
# 自動擴展配置
# ========================================
AUTO_SCALING_ENABLED=true
MIN_REPLICAS=2
MAX_REPLICAS=10
CPU_THRESHOLD=70
MEMORY_THRESHOLD=80
SCALE_UP_COOLDOWN=300
SCALE_DOWN_COOLDOWN=600

# ========================================
# 安全掃描配置
# ========================================
SECURITY_SCAN_ENABLED=true
VULNERABILITY_SCAN_SCHEDULE=0 4 * * *  # 每天凌晨 4 點
DEPENDENCY_CHECK_ENABLED=true
CODE_QUALITY_GATE_ENABLED=true

# ========================================
# 業務指標配置
# ========================================
BUSINESS_METRICS_ENABLED=true
CONVERSION_TRACKING=true
REVENUE_TRACKING=true
USER_ANALYTICS=true
PERFORMANCE_ANALYTICS=true

# A/B 測試
AB_TESTING_ENABLED=true
AB_TESTING_PROVIDER=optimizely  # optimizely, google_optimize, custom